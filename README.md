# 逆フーリエ変換による画像の再構成

コードは「fourier.py」の方にある.

マウスの操作があるときに呼ばれる関数,マウスイベントやウインドウを表示するプログラムは,https://www.tech-tech.xyz/3132153.html の"線を描く"
を参考にした.今回は,フーリエ変換したものを,逆フーリエ変換して画像の再構成を行う.
まず,画像をグレースケールで読み込み,フーリエ変換する.このフーリエ変換したものから,
ある地点の値を引き出し複素数型の二次元配列に格納し,逆フーリエ変換をして,
正弦波を表した縞模様が表示されるようにしている.
これらの操作をマウスのクリックやドラッグにより行っており,25から62行目で実装している.
65行目でウインドウの名前の設定,67行目でコールバック関数の設定,68から81行目でウインドウ表示している.
cv2.imshowで表示したい画像を指定している.
IM1は,フーリエ変換後の各点での周波数,IMM1は複数の周波数が格納されるようにしている
IM2は各点での,IMM2は複数の周波数を逆フーリエ変換したものを格納する配列である.
IM2とIMM2を処理して,そのまま画面に表示しようとしたが,IM2とIMM2は複素数型なので
cv2,imshow()で表示することができない.この問題に面した時,私は,
実数型の配列"only"と配列"recon"を作成した.それぞれ,その点での空間領域での波形,再構成した空間領域での画像を表す.
そして,41,42,59,60行目でonlyとreconにそれぞれIM2とIMM2の実数成分を代入することにより解決した.
しかし,cv2.imshow()では,値の範囲が0.0から1.0までに自動的に設定されるので,そのまま
onlyとreconを表示することができなかった.その時,https://qiita.com/QUANON/items/188baf469fd493a2f1e6
より,ある値の範囲を0以上1以下の範囲に正規化する方法を探し出し,
43,44,61,62行目のように実装することで解決した.13行目の振幅スペクトルを表示する際にも同じような問題が発生したので,同様の方法で解決した.

実行すると,5つのウインドウが表示される.一つ目は,"img"という名前で,元画像が表示される.二つ目は,"frequency"という名前で,元画像の振幅スペクトルが表示される.
三つ目は,"locate"という名前で,振幅スペクトルの座標位置と対応した.黒色の画像が表示される.
四つ目は,"only"という名前で,各点での空間領域での波形が縞模様で表示される.
五つ目は,"recon"という名前で再構成した空間領域での画像が表示される.
この中の三つ目の画像locateをクリックすることでプログラムが動作する.
始めに,ある点をクリックすると,onlyの方にはその点での波形が,reconにもその点での波形が表示される.locateには白の点が表示される.
次に,ある点をクリックすると,onlyの方には,その点での波形が更新され,
reconには,onlyとは違う波形が出てくる.locateにも白の点が表示される.locateの方でドラッグを繰り返すと,
reconの方に段々と元画像が浮かび上がってくる様子がわかるであろう.
locateでクリックやドラッグをする際,処理スピードによるものなのか,素早くドラッグを
すると,白の点が飛び飛びになり,再構成の動作もかくつくので,ゆっくりとドラッグすることを推奨する.

依存ライブラリとしては,関数cv2.imshow()を使うためのcv2,配列arrayのためのnumpyを利用した.

バージョンは,3.7.3 (default, Mar 27 2019, 17:13:21) [MSC v.1915 64 bit (AMD64)]である.

gifを作成する際,ScreenToGifを用いてスクリーンショットのgifを作成し,githubに掲載しようと試みた.
しかし,gifは表示されず,"content length exceeded"というメッセージが表示された.
https://stackoverflow.com/questions/42263625/big-gif-from-a-third-party-site-does-not-show-in-the-readme-md-of-github
のサイトを見て対策しようとしたがそれでもうまくいかず,今度はなるべく容量が少なくなるようにgifを作成したが,どの方法でも
gifは表示されなかった.結局,スマホで実行の様子を撮影し,gifを作成することとなった.

一番下の画像は,元画像とその振幅スペクトルであり,今回はこれを使った.ちなみに,https://www.hello-python.com/2018/02/16/numpy%E3%81%A8opencv%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%9F%E7%94%BB%E5%83%8F%E3%81%AE%E3%83%95%E3%83%BC%E3%83%AA%E3%82%A8%E5%A4%89%E6%8F%9B%E3%81%A8%E9%80%86%E5%A4%89%E6%8F%9B/
より引用した.

![demo](https://raw.github.com/wiki/oki-tomohiro/naga-tomohiro/images/fourier2.gif)

![demo](https://raw.github.com/wiki/oki-tomohiro/naga-tomohiro/images/fuji.png)

